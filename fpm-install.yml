---
 - hosts: build_machines
   gather_facts: yes
   sudo: yes
   vars:
     proxy_protocol: http
     proxy_username: USERNAME
     proxy_password: PASSWORD
     proxy_address: itproxy-farm.toll.com.au
     proxy_port: 8080
     proxy: "{{proxy_protocol}}://{{proxy_username}}:{{proxy_password}}@{{proxy_address}}:{{proxy_port}}"

   tasks:
     - name: DEB - Install ruby-dev pacakge
       apt: name=ruby-dev 
       environment:
         http_proxy: "{{proxy}}"
       when: ansible_os_family  == "Debian" or "Ubuntu"
     - name: RPM - Install  ruby-dev package
       environment:
          http_proxy: "{{proxy}}"
       yum: name=ruby-devel  
       ignore_errors: yes
       when: ansible_os_family == "Redhat" or "Fedora" or "CentOS"
     - name: Install Ruby GEM
       environment:
          http_proxy: "{{proxy}}"
       command: bash -lc "gem install fpm"


